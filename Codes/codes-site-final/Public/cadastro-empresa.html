<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Queijo no ponto | Cadastro Empresarial</title>
    <link rel="stylesheet" href="css/style_cadastro.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>

<body>

    <header id="scroll-element">
        <nav class="navbar">
            <a href="#" class="nav-logo">
                <div>
                    <img src="imgs/logo.svg" style="height: 100px; margin-top: 10px;">
                </div>
            </a>
            <ul class="nav-menu">
                <button id="menu-close-button" class="fas fa-times"></button>
                <li class="nav-item"><a href="index.html" class="nav-link">Início</a></li>
                <li class="nav-item"><a href="#menu" class="nav-link">Serviços</a></li>
                <li class="nav-item"><a href="#about" class="nav-link">Sobre</a></li>
                <li class="nav-item"><a href="#menu" class="nav-link">Equipe</a></li>
                <li class="nav-item"><a href="#contact" class="nav-link">Contato</a></li>
                <li class="nav-item"><a href="entrar.html" class="nav-link">Login</a></li>
                <li class="nav-item"><a href="cadastro-empresa.html" class="nav-link">Cadastro</a></li>
            </ul>
            <button id="menu-open-button" class="fas fa-bars"></button>
        </nav>
    </header>

    <section class="container">
        <div id="header">Cadastro Empresarial</div>
        <form action="#" class="form">
            <div class="input-box">
                <label>Razão Social:</label>
                <input id="razao_input" type="text" placeholder="Razão Social" />
            </div>

            <div class="input-box">
                <label>Nome fantasia:</label>
                <input id="nomeFantasia_input" type="text" placeholder="Nome da Empresa" />
            </div>

            <div class="column">
                <div class="input-box">
                    <label>Número de Telefone:</label>
                    <input type="tel" id="telefone_input" placeholder="Digite o número de telefone" required />
                </div>
                <div class="input-box">
                    <label>CNPJ:</label>
                    <input id="cnpj_input" type="" maxlength="18" placeholder="Digite seu CNPJ"
                        onkeyup="validarCNPJ()" />
                    <div id="validacaoCNPJ"></div>
                </div>
                <div class="input-box">
                    <label>CPF:</label>
                    <input id="cpf_input" type="text" maxlength="14" placeholder="Digite seu CPF"
                        onkeyup="validarCPF()" />
                    <div id="validacaoCPF"></div>
                </div>
            </div>
            <div class="input-box">
                <label>Representante legal:</label>
                <input id="representante_input" type="text" placeholder="Nome do Representante" />
            </div>
            <div class="column">
                <div class="input-box">
                    <label>CEP:</label>
                    <input id="cep_input" type="text" placeholder="Digite seu CEP" onblur="buscarEnderecoPorCEP()" required />
                </div>
                <div class="input-box">
                    <label>Bairro:</label>
                    <input id="bairro_input" type="text" placeholder="Bairro" readonly  />
                </div>
                <div class="input-box">
                    <label>Cidade:</label>
                    <input id="cidade_input" type="text" placeholder="Cidade" readonly  />
                </div>
                <div class="input-box">
                    <label>Estado:</label>
                    <input id="uf_input" type="text" placeholder="Estado" readonly  />
                </div>
            </div>
            <div class="input-box">
                <label>Logradouro:</label>
                <input id="logradouro_input" type="text" placeholder="Logradouro" readonly  />
            </div>
            <div class="column">
                <div class="input-box">
                    <label>Senha:</label>
                    <input id="senha_input" type="password" placeholder="******" onkeyup="validarSenha()" />
                    <div id="validacaoSenha"></div>
                </div>
                <div class="input-box">
                    <label>Confirme a Senha:</label>
                    <input id="senha_confirmacao_input" type="password" placeholder="******"
                        onkeyup="confirmacaoSenha()" />
                    <div id="validacaoSenha"></div>
                </div>
                <div id="validacaoConfirmacao"></div>
            </div>
            <div class="column">
                <div class="input-box">
                    <label>Email:</label>
                    <input id="email_input" type="email" placeholder="Digite o email da empresa" required />
                </div>
            </div>
            <button type="button" onclick="cadastrarEmpresa()">Enviar</button>
        </form>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="script/scriptEmpresa.js"></script>
    <script src="script/script.js"></script>
</body>
</html>
<script>
     function buscarEnderecoPorCEP() {
    const cep = document.getElementById("cep_input").value.replace("-", "").trim();
    if (!cep) {
        alert("Por favor, insira um CEP válido.");
        return;
    }

    fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then((response) => response.json())
        .then((data) => {
            if (!data.erro) {
                // Preenche os campos de endereço
                document.getElementById("logradouro_input").value = data.logradouro || "";
                document.getElementById("bairro_input").value = data.bairro || "";
                document.getElementById("cidade_input").value = data.localidade || "";
                document.getElementById("uf_input").value = data.uf || "";
            } else {
                alert("CEP não encontrado!");
                limparCamposEndereco();  // Limpa os campos caso o CEP não seja encontrado
            }
        })
        .catch(() => {
            alert("Erro ao buscar o CEP. Verifique sua conexão ou tente novamente.");
            limparCamposEndereco();  // Limpa os campos em caso de erro
        });
}

function limparCamposEndereco() {
    document.getElementById("logradouro_input").value = "";
    document.getElementById("bairro_input").value = "";
    document.getElementById("cidade_input").value = "";
    document.getElementById("uf_input").value = "";
}

function cadastrarEmpresa() {
    const razaoSocialVar = razao_input.value.trim();
    const nomeFantasiaVar = nomeFantasia_input.value.trim();
    const telefoneVar = telefone_input.value.trim();
    const representanteLegalVar = representante_input.value.trim();
    const emailVar = email_input.value.trim();
    const senhaEmpresaVar = senha_input.value.trim();

    const CepVar = cep_input.value.trim();
    const logradouroVar = logradouro_input.value.trim();
    const bairroVar = bairro_input.value.trim();
    const cidadeVar = cidade_input.value.trim();
    const ufVar = uf_input.value.trim();

    // Validações adicionais de campos obrigatórios
    if (!razaoSocialVar || !nomeFantasiaVar || !cnpjFinal || !telefoneVar || !representanteLegalVar || !emailVar || !senhaEmpresaVar || !CepVar  || !logradouroVar || !bairroVar || !cidadeVar || !ufVar) {
        alert("Por favor, preencha todos os campos obrigatórios.");
        return false;
    }

    console.log({
            logradouroServer: logradouroVar,
            bairroServer: bairroVar,
            cidadeServer: cidadeVar,
            ufServer: ufVar,
            cepServer: CepVar,
            codigoVinculoServer: codigoVinculoVar,
        });
    fetch("/empresas/cadastrar", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            razaoSocial: razaoSocialVar,
            nomeFantasia: nomeFantasiaVar,
            cnpj: cnpjFinal,
            telefone: telefoneVar,
            representanteLegal: representanteLegalVar,
            email: emailVar,
            cpf: cpfFinal,
            senhaEmpresa: senhaEmpresaVar,
            logradouroServer: logradouroVar,
            bairroServer: bairroVar,
            cidadeServer: cidadeVar,
            ufServer: ufVar,
            cepServer: CepVar,
        }),
    })
        .then((resposta) => {
            if (resposta.ok) {
                resposta.json().then((json) => {
                    sessionStorage.setItem("NOME_EMPRESA", json.nomeFantasia);
                    alert("Cadastro de empresa realizado com sucesso!");
                    window.location = "entrar.html";
                });
            } else {
                alert("Houve um erro ao tentar realizar o cadastro.");
            }
        })
        .catch((erro) => {
            console.error("Erro:", erro);
            alert("Erro ao realizar o cadastro da empresa.");
        });

    return false;
}

// Função para validar o formato do CEP
function validarCEP(cep) {
    const regexCEP = /^[0-9]{5}-[0-9]{3}$/; // Formato: XXXXX-XXX
    return regexCEP.test(cep);
}

function validarCNPJ() {
    const cnpj = cnpj_input.value.replace(/\D/g, ""); // Remove caracteres não numéricos
    if (cnpj.length === 14) {
        cnpjFinal = cnpj; // Armazena o CNPJ válido
        validacaoCNPJ.innerHTML = `<span style="color: green;">CNPJ válido</span>`;
    } else {
        cnpjFinal = null;
        validacaoCNPJ.innerHTML = `<span style="color: red;">CNPJ inválido. Insira 14 números.</span>`;
    }
}

function validarCPF() {
    const cpf = cpf_input.value.replace(/\D/g, ""); // Remove caracteres não numéricos
    if (cpf.length === 11) {
        cpfFinal = cpf; // Armazena o CPF válido
        validacaoCPF.innerHTML = `<span style="color: green;">CPF válido</span>`;
    } else {
        cpfFinal = null;
        validacaoCPF.innerHTML = `<span style="color: red;">CPF inválido. Insira 11 números.</span>`;
    }
}

function validarSenha() {
    const senha = senha_input.value.trim();
    if (senha.length >= 7) {
        validacaoSenha.innerHTML = `<span style="color: green;">Senha válida</span>`;
    } else {
        validacaoSenha.innerHTML = `<span style="color: red;">Senha deve ter no mínimo 7 caracteres.</span>`;
    }
}

function confirmacaoSenha() {
    const senha = senha_input.value.trim();
    const confirmacaoSenha = senha_confirmacao_input.value.trim();
    if (senha === confirmacaoSenha) {
        validacaoConfirmacao.innerHTML = `<span style="color: green;">Senhas coincidem</span>`;
    } else {
        validacaoConfirmacao.innerHTML = `<span style="color: red;">As senhas não coincidem</span>`;
    }
}

// Função para tirar pontuação (genérica para CNPJ e CPF)
function tirarPontuacao(texto = "") {
    return texto.replace(/\D/g, "");
}

// Aqui recupera o nome do usuario e da empresa que estão no session
document.addEventListener("DOMContentLoaded", () => {
    // Recupera os dados do sessionStorage
    const nome = sessionStorage.getItem("NOME_USUARIO");
    const nomeFantasia = sessionStorage.getItem("NOME_EMPRESA");

    document.getElementById("nome").textContent = nome;
    document.getElementById("nomeFantasia").textContent = nomeFantasia || "Empresa não informada";
});

</script>


<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Monitoramento - Queijo no Ponto</title>
    <link rel="icon" href="imgs/logo.svg" type="image/svg+xml">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!--biblioteca chart.js-->
    <link rel="stylesheet" href="style_dashboard.css">
</head>

<body>

    <aside class="navbar">
        <img src="imgs/logo.svg " alt="Imagem profile">
        <h2>Bem-vindo, Usuário!</h2>
        <nav>
            <a href="index.html">Página Inicial</a>
            <a href="">Relatórios</a>
            <a href="index.html#about">Sobre</a>

            <div class="opcoes">
                <span>Selecione a Prateleira:</span>
                <select class="custom-select">
                    <option value="2">Prateleira 3</option>
                    <option value="2">Prateleira 1</option>
                    <option value="2">Prateleira 2</option>
                    <option value="3" style="background-color: #920a0a;">Prateleira 3</option>
                    <option value="4" style="background-color: #920a0a;">Prateleira 4</option>
                    <option value="5">Prateleira 5</option>
                </select>
            </div>
            <a href="#">Sair</a>
        </nav>
        <!-- 
            <div class="logo">
                <img clas="logo" src="imgs/logo.svg" alt="">
            </div> -->
    </aside>

    <!--Aqui abaixo são as divs da dashboard no html
     terminando tem a tag <canvas> que é utilizada pra ajudar a criar os gráficos-->

    <div id="dashboard">
        <div class="kpi-bar">
            <div class="kpi">
                <div class="kpi-header">
                    <img src="imgs/alta-temperatura-em-um-termometro.png" alt="Ícone de Temperatura">
                    <h3>Temperatura Média</h3>
                </div>
                <p>18°C</p>
            </div>
            <div class="kpi">
                <div class="kpi-header">
                    <img src="imgs/umidade.png" alt="Ícone de Umidade">
                    <h3>Umidade Média</h3>
                </div>
                <p><b>90%</b></p>
            </div>
            <div class="kpi">
                <div class="kpi-header">
                    <img src="imgs/sinal-de-aviso.png" alt="Ícone de Alerta">
                    <h3>Último Alerta</h3>
                </div>
                <p><b>11/10/2024 17:00</b></p>
            </div>
            <div class="kpi">
                <div class="kpi-header">
                    <img src="imgs/sino.png" alt="Ícone de Salas em Alerta">
                    <h3>Prateleiras em Alerta</h3>
                </div>
                <p><b>2</b></p>
            </div>
        </div>

        <div  id="container-graficos" >
           <div class="linha-graficos">
               <div class="sessao-2">

                   <h3>Temperatura (°C)</h3>
                   <div class="chart-container box">
                       <canvas id="sensorTemperatura"></canvas>
                   </div>
              
                   <h3>Umidade (%)</h3>
                   <div class="chart-container box">
                       <canvas id="sensorUmidade"></canvas>
                   </div>
               </div>
               <div class="chart-container box">
                   <canvas id="barChart"></canvas>
               </div>
           </div>

        </div>
    </div>

    <script>


        // CONFIGURAÇÃO DOS GRAFICOS, O PRIMEIRO É DE TEMPERATURA,
        // AQUI TÁ DEFININDO O TAMANHO, COR, OS DATASET, TEXTO, AS BORDAS, OS CONTEUDOS
        new Chart(document.getElementById('sensorTemperatura').getContext('2d'), {
            type: 'line',
            data: {
                labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
                datasets: [
                    {
                        label: 'Temperatura Atual (°C)',
                        borderColor: '#c59506',
                        data: [9, 13, 17, 15, 12, 14],
                        fill: true
                    },
                    {
                        label: 'Média ideal (°C)',
                        borderColor: 'white',
                        backgroundColor: 'white',
                        data: [10, 10, 10, 10, 10, 10],
                        borderDash: [10, 5],
                        fill: false,
                        borderWidth: 2  //tamanho da borda das
                    },
                    {
                        label: 'Mínima (°C)',
                        borderColor: '#096b21',
                        backgroundColor: '#096b21',
                        data: [7, 7, 7, 7, 7, 7],
                        borderDash: [10, 5],
                        fill: false,
                        borderWidth: 2
                    },
                    {
                        label: 'Máxima (°C)',
                        borderColor: '#920a0a',
                        backgroundColor: '#920a0a',
                        data: [14, 14, 14, 14, 14, 14],
                        borderDash: [10, 5],
                        fill: false,
                        borderWidth: 2
                    }

                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: {
                            boxWidth: 40, // Ddiminui o tamanho dos quadradinhos
                            color: 'white', // Altera a cor do texto da legenda do graf
                            font: {
                                size: 12// Ajusta o tamanho do texto da legenda do frafico
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: 'white' // Altera a cor dos rótulos do eixo X
                        }
                    },
                    y: {
                        beginAtZero: false,
                        title: {
                            display: true,
                            // text: 'Temperatura (°C)', 
                            color: 'white',
                            font: {
                                size: 12 // Ajusta o tamanho do texto da legenda do frafico
                            }
                        },
                        ticks: {
                            color: 'white' // Altera a cor dos rótulos do eixo Y
                        }
                    }
                }
            }
        });



        //GRAFICO DE UMIDADE DE LINHA:

        new Chart(document.getElementById('sensorUmidade').getContext('2d'), {
            type: 'line',
            data: {
                labels: ['12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
                datasets: [
                    {
                        label: 'Umidade (%)',
                        borderColor: '#030320',
                        data: [90, 95, 89, 92, 100, 98],
                        fill: true
                    },
                    {
                        label: 'Média Ideal (%)',
                        borderColor: 'white',
                        backgroundColor: 'white',
                        data: [80, 80, 80, 80, 80, 80],
                        borderDash: [10, 5],
                        fill: false,
                        borderWidth: 2
                    },
                    {
                        label: 'Mínima (%)',
                        borderColor: '#096b21',
                        backgroundColor: '#096b21',
                        data: [75, 75, 75, 75, 75, 75],
                        borderDash: [10, 5],
                        fill: false,
                        borderWidth: 2
                    },
                    {
                        label: 'Máxima (%)',
                        borderColor: '#920a0a',
                        backgroundColor: '#920a0a',
                        data: [95, 95, 95, 95, 95, 95],
                        borderDash: [10, 5],
                        fill: false,
                        borderWidth: 2 //  
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: {
                            boxWidth: 50, // Ddiminui o tamanho dos quadradinhos
                            color: 'white', // Altera a cor do texto da legenda do graf
                            font: {
                                size: 12 // Ajusta o tamanho do texto da legenda do frafico
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: 'white' // Altera a cor dos rótulos do eixo X
                        }
                    },
                    y: {
                        beginAtZero: false,   //aqui é pra definir se começa em zero, coloquei false no graf de umidade
                        title: {
                            display: true,
                            // text: 'Umidade (%)', 
                            color: 'white'
                        },
                        ticks: {
                            color: 'white' // Altera a cor dos rótulos do eixo Y
                        }
                    }
                }
            }
        });





        //GRÁFICO DE BARRAS DAS MÉDIAS DAS SALAS

        new Chart(document.getElementById('barChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: ['Prateleira 1', 'Prateleira 2', 'Prateleira 3', 'Prateleira 4', 'Prateleira 5'],
                datasets: [{
                    label: 'Temperatura Media (°C)',
                    backgroundColor: ['orange', 'orange', '#920a0a', '#920a0a', 'orange'],
                    data: [10, 7, 18, 20, 13]
                }]
            },



            options: {
                responsive: true,
                plugins: {
                    legend: {
                        labels: {
                            boxWidth: 40, // altera o tamanho dos quadradinhos

                            color: 'white', // Altera a cor do texto da legenda do graf
                            font: {
                                size: 12 // Ajusta o tamanho do texto da legenda do frafico
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: 'white' // Altera a cor dos rótulos do eixo X(sala1, sala2, sala3..)
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            // text: 'Temp Média das Prateleiras(°C)', 
                            color: 'white'
                        },
                        ticks: {
                            color: 'white' // Altera a cor dos rótulos do eixo Y (5 graus, 10, 15,20)
                        }
                    }
                }
            }
        });







        var paginacao = {};
        var tempo = {};

        function obterDados(grafico, endpoint) {
            fetch('http://localhost:3300/dadossensores/' + endpoint)
                .then(response => response.json())
                .then(valores => {
                    if (paginacao[endpoint] == null) {
                        paginacao[endpoint] = 0;
                    }
                    if (tempo[endpoint] == null) {
                        tempo[endpoint] = 0;
                    }

                    var ultimaPaginacao = paginacao[endpoint];
                    paginacao[endpoint] = valores.length;
                    valores = valores.slice(ultimaPaginacao);

                    valores.forEach((valor) => {
                        if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                            grafico.data.labels.shift();
                            grafico.data.datasets[0].data.shift();
                        }

                        grafico.data.labels.push(tempo[endpoint]++);
                        grafico.data.datasets[0].data.push(parseFloat(valor));
                        grafico.update();
                    });
                })
                .catch(error => console.error('Erro ao obter dados:', error));
        }

        setInterval(() => {
            obterDados(sensorTemperatura, 'temperatura');
            obterDados(sensorUmidade, 'umidade');
        }, 1000);

    </script>
</body>

</html>